{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>find - cadastro</title>
    <link rel="stylesheet" href="{% static 'mainpage/css/register.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" />
</head>
<body>

<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow login-card p-4">

        <div class="image-logo text-center">
            <img src="{% static 'mainpage/img/logo-find.png' %}" alt="logo-find" style="width: 100px; height: 50px;" class="mb-2">
        </div>
        
        <hr class="hr-custom mx-auto d-block">
        <h2 class="text-center fw-bold title-gradient mb-4">Cadastre-se</h2>

        <form method="POST">
            {% csrf_token %}
            
            <div class="field-wrapper">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">badge</span>
                    <input type="text" name="full_name" class="form-control border-0" placeholder="Nome completo" required>
                </div>
            </div>

            <div class="field-wrapper">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">person</span>
                    <input type="text" name="username" class="form-control border-0" placeholder="Nome de usuário" required>
                </div>
            </div>

            <div class="field-wrapper position-relative">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">cake</span>
                    <input type="date" id="data_nascimento" name="data_nascimento" class="form-control border-0" required>
                </div>
                <div id="alert-idade" class="error-msg-absolute d-none">
                    É necessário ter pelo menos 13 anos.
                </div>
            </div>

            <div class="field-wrapper">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">email</span>
                    <input type="email" name="email" class="form-control border-0" placeholder="Email" required>
                </div>
            </div>

            <div class="field-wrapper">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">lock</span>
                    <input type="password" name="password" class="form-control border-0" placeholder="Senha" required>
                </div>
            </div>

            <div class="field-wrapper">
                <div class="input-group rounded-pill">
                    <span class="material-symbols-rounded">lock</span>
                    <input type="password" name="confirm_password" class="form-control border-0" placeholder="Confirmar senha" required>
                </div>
            </div>

            <button id="btn-registrar" class="btn btn-primary w-50 mt-3 mx-auto d-block rounded-pill fw-bold" type="submit">
                REGISTRAR
            </button>
        </form>

        <p class="text-center mt-3 mb-0">
            Já tem conta? <a href="{% url 'login' %}" class="small-password-link">Entre aqui</a>
        </p>
    </div>
</div>

<script>
    const form = document.querySelector('form');
    const inputData = document.getElementById('data_nascimento');
    const alerta = document.getElementById('alert-idade');
    const btn = document.getElementById('btn-registrar');

    function calcularIdade(dataValue) {
        if (!dataValue) return 0;
        const hoje = new Date();
        const dataNasc = new Date(dataValue);
        let idade = hoje.getFullYear() - dataNasc.getFullYear();
        const m = hoje.getMonth() - dataNasc.getMonth();
        if (m < 0 || (m === 0 && hoje.getDate() < dataNasc.getDate())) {
            idade--;
        }
        return idade;
    }

    // Apenas mostra o erro visual
    inputData.addEventListener('change', function() {
        if (this.value && calcularIdade(this.value) < 13) {
            alerta.classList.remove('d-none');
        } else {
            alerta.classList.add('d-none');
        }
    });

    // Bloqueia o envio sem mudar o visual do botão
    form.addEventListener('submit', function(event) {
        if (calcularIdade(inputData.value) < 13) {
            event.preventDefault(); // Não deixa cadastrar
            alerta.classList.remove('d-none');
            
            // Efeito de erro no botão (ele treme)
            btn.style.animation = 'shake 0.4s';
            setTimeout(() => { btn.style.animation = ''; }, 400);
        }
    });
</script>
</body>
</html>